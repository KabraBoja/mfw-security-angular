!function(){"use strict";function a(){function a(a){c[a.id]=a}function b(a){angular.isObject(a)&&(a=[a]),angular.forEach(a)}var c={},d=void 0;this.addStaticUser=a,this.addStaticUsers=b,this.$get=["$q","$log","$timeout","$rootScope","$mfwSecurityConfig","$injector",function(a,b,c,e,f,g){function h(){var a=y.get();if(angular.isDefined(a)){b.log("Loading stored user information:",a);var c=z.fromStorage(a);this.activate(c)}}function i(a){function c(c){b.log("Stored credentials are still valid."),c===!0?(d=a,u(d)):e()}function e(){b.log("Stored credentials are now invalid. Removing them."),y.clear(),v()}c(!0)}function j(a){var b=z.parse(a);y.set(b),this.activate(b)}function k(){angular.isUndefined(d)&&b.warn("Log out when there's not an active user."),d=void 0,y.clear(),v()}function l(){return d}function m(){return angular.isDefined(l())}function n(a,b){if(angular.isUndefined(d))throw new Error("Not logged user.");b=b||[],angular.isArray(b)||(b=[b]),"add"===a?d.permissions=_.union(d.permissions||[],b):"remove"===a?d.permissions=_.difference(d.permissions||[],b):"set"===a&&(d.permissions=b)}function o(){if(angular.isUndefined(d))throw new Error("Not logged user.");return d?d.permissions:[]}function p(a){b.debug("Checkin ANY permission from",a);var c=s(a),d=o(),e=c.filter(t);return d.length&&e.length>0}function q(a){if(b.debug("refreshAccessToken"),angular.isUndefined(d))throw new Error("Not logged user.");var c=d;c.accessToken=a,y.set(c),w()}function r(a){b.debug("Checkin ALL permission from",a);var c=s(a),d=o(),e=c.filter(t);return d.length&&e.length===c.length}function s(a){return angular.isArray(a)||(angular.isString(a)?a=a.split(","):angular.isObject(a)&&(a=[a])),a}function t(a){var c=!1,d=a;"!"===a.charAt(0)&&(c=!0,d=a.substring(1));var e=o().indexOf(d)!==-1,f=c?!e:e;return c?b.debug("User has not permission",d,"?",f):b.debug("User has permission",a,"?",f),f}function u(a){x(f.EVENT_LOGIN,angular.copy(a))}function v(){x(f.EVENT_LOGOUT)}function w(){x(f.EVENT_UPDATE_CREDENTIALS,d)}function x(a,b){e.$broadcast(a,b)}var y=g.get(f.storage||"$mfwSecurityStorageDummy"),z=g.get(f.userInfoParser||"$mfwSecurityParserIdentity"),A={init:h,activate:i,logged:j,logout:k,isLogged:m,me:l,setPermissions:n,refreshAccessToken:q,hasAnyPermission:p,hasAllPermissions:r};return A}]}var b=angular.module("mfw.security",[]);b.run(["$mfwSecurity",function(a){a.init()}]),b.constant("$mfwSecurityConfig",{heartbeatInterval:1e3,currentUserGetter:void 0,storage:"$mfwSecurityStorageCookie",userInfoParser:"$mfwSecurityParserJWT",EVENT_LOGIN:"$mfwSecurityLogin",EVENT_LOGOUT:"$mfwSecurityLogout",EVENT_UPDATE_CREDENTIALS:"$mfwSecurityUpdateCredentials"}),b.provider("$mfwSecurity",a),a.$inject=[],b.factory("$mfwSecurityStorageDummy",function(){return{get:angular.noop,set:angular.noop,clear:angular.noop}})}(),function(){"use strict";function a(a,b){return{restrict:"A",terminal:!0,priority:1001,compile:function(c,d){var f=d.mfwSecHasAnyPermission||d.from;c.removeAttr("mfw-sec-has-any-permission");var g=e();c.attr("ng-if",g+"()");var h=a(c,null,1500);return function(a){a[g]=function(){return b.isLogged()&&b.hasAnyPermission(f)},h(a)}}}}function b(a,b){return{restrict:"A",terminal:!0,priority:1001,compile:function(c,d){var f=d.mfwSecHasAllPermissions||d.from;c.removeAttr("mfw-sec-has-all-permissions");var g=e();c.attr("ng-if",g+"()");var h=a(c,null,1500);return function(a){a[g]=function(){return b.isLogged()&&b.hasAllPermissions(f)},h(a)}}}}function c(a,b){return{restrict:"A",terminal:!0,priority:1001,compile:function(c){c.removeAttr("mfw-sec-if-logged");var d=e();c.attr("ng-if",d+"()");var f=a(c,null,1500);return function(a){a[d]=function(){return b.isLogged()},f(a)}}}}function d(a,b){return{restrict:"A",terminal:!0,priority:1001,compile:function(c){c.removeAttr("mfw-sec-if-logged-out");var d=e();c.attr("ng-if",d+"()");var f=a(c,null,1500);return function(a){a[d]=function(){return b.isLogged()},f(a)}}}}function e(){var a=Math.ceil(1e3*Math.random())+1;return"$hasEnoughPermisssion"+a}var f=angular.module("mfw.security");f.directive("mfwSecHasAnyPermission",a),a.$inject=["$compile","$mfwSecurity"],f.directive("mfwSecHasAllPermissions",b),b.$inject=["$compile","$mfwSecurity"],f.directive("mfwSecIfLogged",c),c.$inject=["$compile","$mfwSecurity"],f.directive("mfwSecIfLoggedOut",d),d.$inject=["$compile","$mfwSecurity"]}();
//# sourceMappingURL=mfw-security.min.js.map